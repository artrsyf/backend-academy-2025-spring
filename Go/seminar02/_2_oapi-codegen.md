# Подходы к генерации oapi

### Spec first

Сначала пишется спецификация в yaml или json. На её основе генерируется сервер/клиент. Специалисты в отрасли 
чаще всего сходятся во мнении, что такой подход предпочтителен. Только при таком походе гарантируется, что 
спецификация будет соответствовать коду. Модели и описание методов будут актуальными. Мы его раздерём дальше.

### Code first

Этот подход предполагает, что сначала пишется код обработчиков. К нему пишутся комментарии в определённом формате. 
На его основе комментариев генерируется спецификация. Чаще всего этот подход используют для того, чтобы создать 
OpenAPI спецификацию для уже работающего кода. Для чего это может понадобиться, как думаете?

```go
// @Summary Удаление ученика с курса
// @tags students-v2
// @Description Перевод ученика в статус deleted
// @Description Удаление запрещено, если ученик был отчислен или закончил обучение
// @Accept  json
// @Produce  json
// @Param student_id path string true "student_id" StudentFormat(uuid)
// @Success 200
// @Failure	400	{object}	httpcmn.Error "invalid_input"
// @Failure	500	{object}	httpcmn.Error
// @Router /v2/student/{student_id} [delete].
func (h *Handler) deleteStudent(c *gin.Context) {
	// handler logic no matter
}
```

# oapi-codegen

## Общие сведения

`oapi-codegen` - один из инструментов для автоматической генерации клиентского кода и серверных интерфейсов на основе
спецификаций OpenAPI. Он поддерживает различные языки программирования и фреймворки. Это позволяет быстро создавать 
код для взаимодействия с API без необходимости ручного написания.

## Возможности oapi-codegen для Go

### Генерация клиентского кода

Позволяет создавать клиентские библиотеки на Go, которые автоматически реализуют все методы, описанные в
спецификации OpenAPI. Это упрощает взаимодействие с API, так как клиенты могут использовать готовые методы
без необходимости ручного написания HTTP-запросов.

### Генерация серверного кода

`oapi-codegen` может генерировать серверные обработчики на Go, создавая структуру проекта, которая реализует API.
Этот код может включать валидацию входных данных, обработку ошибок и другой необходимый функционал.

### Поддержка OpenAPI 3.0

Инструмент поддерживает спецификации OpenAPI 3.0, что позволяет использовать новые возможности, такие как
улучшенная поддержка форматов данных и расширенные возможности для описания API.

### Конфигурируемые шаблоны

`oapi-codegen` позволяет настраивать и расширять код, используя пользовательские шаблоны Go, что дает
возможность адаптировать генерируемый код к специфическим требованиям проекта.

### Интеграция с фреймворками

Сгенерированный код может быть интегрирован с различными фреймворками для Go.

- Chi
- Echo
- Fiber
- Gin
- gorilla/mux
- Iris
- net/http

### Автоматизация

`oapi-codegen` можно интегрировать в CI/CD процессы, что позволяет автоматизировать генерацию кода при изменениях
в спецификациях API.

### Валидация спецификаций

Инструмент включает механизмы проверки спецификаций OpenAPI, что помогает обнаружить и устранить ошибки еще
до запуска приложения.

## Установка

```bash
go install github.com/oapi-codegen/oapi-codegen/v2/cmd/oapi-codegen@latest
```

## Использование

### Вызов command line утилиты
```bash
oapi-codegen -config config.yaml ../oapi/openapi.yaml
```

### Используя go:generate
```go
package generate

//go:generate oapi-codegen -config config.yaml ../oapi/openapi.yaml
```

### Посредством паттерна tools.go (tools/tools.go)

```go
//go:build tools
// +build tools

package tools

import (
	_ "github.com/oapi-codegen/oapi-codegen/v2/cmd/oapi-codegen"
)

//go:generate go run github.com/oapi-codegen/oapi-codegen/v2/cmd/oapi-codegen --config=config.yaml ../../api.yaml
```

## Использование сгенерированного кода

- Имплементировать методы сервера/клиента
- Подготовить необходимые зависимости (mux, auth и т.д.)
- При необходимости реализовать middlewares либо использовать предложенные в документации
- Запустить свой сервер на основе выбранного фреймворка